<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIå·¥ä½œæµæµ‹è¯•ç«¯MVP</title>
    <style>
        :root {
            --primary-color: #1890ff;
            --secondary-color: #f0f2f5;
            --text-color: #333;
            --border-color: #d9d9d9;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 0;
            color: var(--text-color);
            background-color: #f5f5f5;
        }
        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }
        /* æ¨¡å¼åˆ‡æ¢å™¨ */
        .mode-switcher {
            background: white;
            padding: 12px 24px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            gap: 16px;
        }
        .mode-btn {
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            border: 1px solid transparent;
            font-weight: 500;
        }
        .mode-btn.active {
            background: var(--primary-color);
            color: white;
        }
        .mode-btn.inactive {
            border-color: var(--border-color);
        }
        .mode-btn.inactive:hover {
            color: var(--primary-color);
            border-color: var(--primary-color);
        }
        /* ä¸»å†…å®¹åŒº */
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        /* ç­›é€‰åŒº */
        .filter-panel {
            width: 280px;
            background: white;
            border-right: 1px solid var(--border-color);
            padding: 16px;
            overflow-y: auto;
        }
        .filter-group {
            margin-bottom: 16px;
        }
        .filter-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 4px;
            display: block;
        }
        .filter-input {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid var(--border-color);
            border-radius: 2px;
        }
        .filter-select {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid var(--border-color);
            border-radius: 2px;
            background: white;
        }
        /* ä¼šè¯åˆ—è¡¨åŒº */
        .session-list {
            background: white;
            border-bottom: 1px solid var(--border-color);
            max-height: 200px;
            overflow-y: auto;
        }
        .session-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        .session-table th {
            background: #fafafa;
            padding: 8px 12px;
            text-align: left;
            font-weight: 500;
            position: sticky;
            top: 0;
        }
        .session-table td {
            padding: 12px;
            border-bottom: 1px solid var(--secondary-color);
        }
        .session-table tr:hover {
            background: #fafafa;
        }
        .session-table .active {
            background: #e6f7ff;
        }
        .load-btn {
            color: var(--primary-color);
            background: none;
            border: none;
            cursor: pointer;
            padding: 0;
            text-decoration: underline;
        }
        /* å¯¹è¯å±•ç¤ºåŒº */
        .conversation-panel {
            flex: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .conversation-container {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            background: white;
        }
        /* æ¶ˆæ¯æ ·å¼ */
        .message {
            margin-bottom: 16px;
            position: relative;
            padding-left: 40px;
        }
        .message-header {
            display: flex;
            align-items: center;
            margin-bottom: 4px;
        }
        .message-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            margin-right: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
            position: absolute;
            left: 0;
        }
        .message-sender {
            font-weight: 500;
            margin-right: 8px;
        }
        .message-time {
            font-size: 12px;
            color: #999;
        }
        .message-content {
            margin-bottom: 8px;
        }
        .message-text {
            white-space: pre-wrap;
            word-break: break-word;
        }
        .message-image {
            max-width: 200px;
            max-height: 200px;
            border-radius: 4px;
        }
        /* è§’è‰²ç‰¹å®šæ ·å¼ */
        .teacher .message-avatar {
            background: var(--teacher-color);
        }
        .parent .message-avatar {
            background: var(--parent-color);
        }
        .ai .message-avatar {
            background: var(--ai-color);
        }
        /* æ¶ˆæ¯æ§åˆ¶åŒº */
        .message-controls {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }
        .control-btn {
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 2px;
            cursor: pointer;
            border: 1px solid var(--border-color);
            background: white;
        }
        .include-checkbox {
            margin-right: 8px;
        }
        /* æ“ä½œåŒº */
        .action-panel {
            padding: 12px 16px;
            background: white;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 8px;
        }
        .action-btn {
            padding: 6px 12px;
            border-radius: 2px;
            cursor: pointer;
            border: 1px solid var(--border-color);
            background: white;
        }
        .primary-btn {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        /* å·®å¼‚é«˜äº® */
        .diff-added {
            background: #f6ffed;
            border-bottom: 1px solid #b7eb8f;
        }
        .diff-removed {
            background: #fff2f0;
            border-bottom: 1px solid #ffccc7;
        }
        /* é”™è¯¯çŠ¶æ€ */
        .error-status {
            color: var(--error-color);
            background: #fff1f0;
            padding: 1px 4px;
            border-radius: 2px;
            font-size: 12px;
        }
        /* æ–°å¢ï¼šAIé‡è¯•ç»“æœæ ·å¼ */
        .test-result-box {
            background: #e6f7ff;
            border: 1px solid #91d5ff;
            border-radius: 4px;
            margin-top: 8px;
            padding: 10px 14px;
            color: #0050b3;
            font-size: 14px;
            box-shadow: 0 2px 8px rgba(24,144,255,0.06);
            position: relative;
        }
        .test-result-box .test-result-title {
            font-weight: bold;
            margin-bottom: 4px;
            color: #096dd9;
        }
        .test-result-box .test-result-diff {
            margin-top: 4px;
            font-size: 13px;
            color: #333;
        }
        /* åŒºåˆ†AIå’Œå·¥ä½œæµæ¶ˆæ¯é¢œè‰² */
        .message.ai { background: #e6f7ff; }
        .message.workflow-msg { background: #fffbe6; }
    </style>
</head>
<body>
    <div class="container" id="app">
        <!-- æ¨¡å¼åˆ‡æ¢å™¨ -->
        <div class="mode-switcher" style="display: flex; align-items: center;">
            <div class="mode-btn active" data-mode="badcase" onclick="switchMode('badcase', this)">ğŸ” Badcaseå¤ç°ï¼ˆå¸¦å†å²è®°å½•ï¼‰</div>
            <div class="mode-btn inactive" data-mode="workflow" onclick="switchMode('workflow', this)">âš™ï¸ å·¥ä½œæµæµ‹è¯•ï¼ˆæ— æ¶ˆæ¯è®°å½•ï¼Œä¸€ä¸ªæœºå™¨äººå¯èƒ½ç»‘å¤šæ¡promptï¼‰æ¨¡å¼</div>
            <button class="action-btn" style="margin-left:auto;" onclick="openSessionLog()">ä¼šè¯è®°å½•çª—å£</button>
        </div>
        
        <div class="main-content" style="display: flex; height: 100%;">
            <!-- å·¦ä¾§ç­›é€‰åŒº -->
            <div class="filter-panel">
                <div class="filter-group">
                    <label class="filter-label">è€å¸ˆä¼å¾®ID</label>
                    <input type="text" class="filter-input" placeholder="è¾“å…¥è€å¸ˆID">
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">å­¦ç”Ÿä¼å¾®ID</label>
                    <input type="text" class="filter-input" placeholder="è¾“å…¥å­¦ç”ŸID">
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">ä»»åŠ¡åç§°</label>
                    <select class="filter-select">
                        <option value="">è‡ªåŠ¨æ¿€æ´»</option>
                        <option value="abnormal">ç¡®è®¤å§“å</option>
                        <option value="complete">ç¡®è®¤æ‰‹æœºå·</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">ä»»åŠ¡çŠ¶æ€</label>
                    <select class="filter-select">
                        <option value="">å…¨éƒ¨</option>
                        <option value="abnormal">å¼‚å¸¸</option>
                        <option value="complete">å®Œæˆ</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">è¯¾ç¨‹ç¼–ç </label>
                    <input type="text" class="filter-input" placeholder="è¾“å…¥è¯¾ç¨‹ç¼–ç ">
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">ç­çº§ç¼–ç </label>
                    <input type="text" class="filter-input" placeholder="è¾“å…¥ç­çº§ç¼–ç ">
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">ä¼šè¯å…³é”®è¯</label>
                    <input type="text" class="filter-input" placeholder="è¾“å…¥å…³é”®è¯">
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">æœºå™¨äººç¼–ç </label>
                    <select class="filter-select">
                        <option value="">å…¨éƒ¨</option>
                        <option value="bot1">æ•™å­¦åŠ©æ‰‹v1.2</option>
                        <option value="bot2">å®¶é•¿æœåŠ¡v2.0</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">æ—¶é—´èŒƒå›´</label>
                    <select class="filter-select">
                        <option value="custom">è‡ªå®šä¹‰</option>
                    </select>
                </div>
                <button class="btn btn-primary" style="width: 100%; margin-top: 8px;">æœç´¢</button>
            </div>
            <!-- å³ä¾§å†…å®¹åŒºï¼šbadcaseå’Œworkflowä¸¤ä¸ªpaneläº’æ–¥æ˜¾ç¤º -->
            <div style="flex:1; display:flex; flex-direction:column; min-width:0;">
                <!-- badcaseå¤ç°åŒº -->
                <div id="badcase-panel" style="display: flex; flex-direction: column; height: 100%;">
                    <!-- ä¼šè¯åˆ—è¡¨åŒº -->
                    <div class="session-list" id="session-list" style="max-height: 200px; overflow-y: auto;">
                        <table class="session-table">
                            <thead>
                                <tr>
                                    <th>ä¼šè¯id</th>
                                    <th>è€å¸ˆID</th>
                                    <th>å­¦ç”ŸID</th>
                                    <th>ä¼šè¯çŠ¶æ€</th>
                                    <th>ä¼šè¯å¤‡æ³¨</th>
                                    <th>åˆ›å»ºæ—¶é—´</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="active">
                                    <td>111111</td>
                                    <td>T10086</td>
                                    <td>S2023001</td>
                                    <td><span class="error-status">å¼‚å¸¸</span></td>
                                    <td>XXXXXXXXXXXXXXX</td>
                                    <td>2025-06-13 13:36:19</td>
                                    <td><button class="load-btn" onclick="loadSession(1)">åŠ è½½</button></td>
                                </tr>
                                <tr>
                                    <td>XXXXXXX</td>
                                    <td>T10087</td>
                                    <td>S2023002</td>
                                    <td>æ­£å¸¸</td>
                                    <td>XXXXXXXXXXXXXXX</td>
                                    <td>2025-06-12 15:22:10</td>
                                    <td><button class="load-btn" onclick="loadSession(2)">åŠ è½½</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <!-- é¡µç ç¿»é¡µå™¨ -->
                    <div class="pagination" id="pagination" style="display: flex; justify-content: flex-end; align-items: center; padding: 8px 0 8px 0; background: #fff; border-bottom: 1px solid #f0f2f5;">
                        <button class="page-btn" style="margin: 0 4px; padding: 2px 8px; border: 1px solid #d9d9d9; background: #fafafa; cursor: pointer; border-radius: 2px;">ä¸Šä¸€é¡µ</button>
                        <span style="margin: 0 8px;">ç¬¬ <b>1</b> / <b>5</b> é¡µ</span>
                        <button class="page-btn" style="margin: 0 4px; padding: 2px 8px; border: 1px solid #d9d9d9; background: #fafafa; cursor: pointer; border-radius: 2px;">ä¸‹ä¸€é¡µ</button>
                    </div>
                    <!-- å¯¹è¯å±•ç¤ºåŒº -->
                    <div class="conversation-panel" id="conversation-panel">
                        <div style="padding: 12px 16px; font-weight: bold; font-size: 16px; border-bottom: 1px solid #f0f2f5; background: #fafafa;">ä¼šè¯è®°å½•</div>
                        <div class="conversation-container" id="conversation-container">
                            <!-- æ¶ˆæ¯1 -->
                            <div class="message parent">
                                <div class="message-header">
                                    <div class="message-avatar">å®¶</div>
                                    <div class="message-sender">å®¶é•¿</div>
                                    <div class="message-time">2025-06-13 13:36:51</div>
                                </div>
                                <div class="message-content">
                                    <div class="message-text">ç›´æ’­è¯¾æœ‰å›æ”¾å—</div>
                                    <div class="message-controls">
                                        <label>
                                            <input type="checkbox" class="include-checkbox" checked>
                                            åŒ…å«åœ¨æµ‹è¯•ä¸­
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <!-- æ¶ˆæ¯2 å·¥ä½œæµæ¶ˆæ¯ -->
                            <div class="message workflow-msg" style="background:#fffbe6;">
                                <div class="message-header">
                                    <div class="message-avatar">å¸ˆ</div>
                                    <div class="message-sender">å·¥ä½œæµæ¶ˆæ¯</div>
                                    <div class="message-time">2025-06-13 13:37:41</div>
                                </div>
                                <div class="message-content">
                                    <div class="message-text">[æµç¨‹æé†’] è¯·ç¡®è®¤å­¦ç”Ÿä¿¡æ¯</div>
                                    <div class="message-controls">
                                        <label>
                                            <input type="checkbox" class="include-checkbox" checked>
                                            åŒ…å«åœ¨æµ‹è¯•ä¸­
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <!-- æ¶ˆæ¯3 AIæ¶ˆæ¯ -->
                            <div class="message ai" style="background:#e6f7ff;">
                                <div class="message-header">
                                    <div class="message-avatar">AI</div>
                                    <div class="message-sender">AI</div>
                                    <div class="message-time">2025-06-13 13:39:05</div>
                                </div>
                                <div class="message-content">
                                    <div class="message-text">å¥½çš„ï¼Œæ˜ç™½é‚£å­©å­å‘¨å…­å‘¨å¤©æ¥ä¸Šè¯¾ç¨‹å°±è¡Œï¼Œå››èŠ‚è¯¾çš„çŸ¥è¯†ç‚¹éƒ½æ˜¯ç‹¬ç«‹çš„[æŠ±æ‹³]</div>
                                    <div class="message-controls">
                                        <label>
                                            <input type="checkbox" class="include-checkbox" checked>
                                            åŒ…å«åœ¨æµ‹è¯•ä¸­
                                        </label>
                                        <button class="control-btn" onclick="retestMessage(this)">é‡æ–°æµ‹è¯•</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- èŠå¤©è¾“å…¥åŒºåŸŸ -->
                        <div class="chat-input-panel" style="display: flex; align-items: center; gap: 8px; padding: 12px 16px; border-top: 1px solid #d9d9d9; background: #fafafa;">
                            <span id="workflow-role-tip">ä½œä¸º</span>
                            <select id="workflowSenderRole" style="padding: 4px 8px; border-radius: 2px; border: 1px solid #d9d9d9;" onchange="updateRoleTip('workflow')">
                                <option value="parent">å®¶é•¿</option>
                                <option value="teacher">è€å¸ˆ</option>
                            </select>
                            <span id="workflow-role-tip">å‘é€ä¿¡æ¯ï¼š</span>
                            <select id="emojiPicker" style="padding: 4px 8px; border-radius: 2px; border: 1px solid #d9d9d9;">
                                <option value="">æ·»åŠ è¡¨æƒ…</option>
                            </select>
                            <input id="chatInput" type="text" placeholder="è¯·è¾“å…¥æ¶ˆæ¯..." style="flex:1; padding: 6px 8px; border-radius: 2px; border: 1px solid #d9d9d9;">
                            <button class="action-btn primary-btn" onclick="sendChatMessage()">å‘é€</button>
                        </div>
                        <!-- æ“ä½œåŒº -->
                        <div class="action-panel">
                            <button class="action-btn" onclick="saveTestCase()" style="margin-left: auto;">ä¿å­˜ä¼šè¯</button>
                        </div>
                    </div>
                </div>
                <!-- å·¥ä½œæµæµ‹è¯•åŒº -->
                <div id="workflow-panel" style="display: none; flex-direction: column; height: 100%;">
                    <div class="workflow-mode" style="flex:1; flex-direction:column;">
                        <!-- æœºå™¨äººåŸºæœ¬ä¿¡æ¯ -->
                        <div class="workflow-bot-info" style="background:#fff; border-bottom:1px solid #f0f2f5; padding:16px;">
                            <h3 style="margin:0 0 8px 0;">æœºå™¨äººä¿¡æ¯</h3>
                            <div>æœºå™¨äººåç§°ï¼š<b>è‡ªå®šä¹‰</b></div>
                            <div>åˆ›å»ºæ—¶é—´ï¼š2025-06-01</div>
                            <div>åˆ›å»ºä»»åŠ¡ï¼šA, B, C, D </div>
                            <div>ç‰ˆæœ¬ï¼šv2.1</div>
                        </div>
                        <!-- èŠå¤©åŒº -->
                        <div class="workflow-conversation-panel" style="flex:1; display:flex; flex-direction:column; background:#fff;">
                            <div style="padding: 12px 16px; font-weight: bold; font-size: 16px; border-bottom: 1px solid #f0f2f5; background: #fafafa;">èŠå¤©æ¡†</div>
                            <div class="conversation-container" id="workflow-conversation-container" style="flex:1; overflow-y:auto; padding:16px;">
                                <!-- ç¤ºä¾‹å¯¹è¯ -->
                                <div class="message parent">
                                    <div class="message-header">
                                        <div class="message-avatar">å®¶</div>
                                        <div class="message-sender">å®¶é•¿</div>
                                        <div class="message-time">2025-06-20 10:00:00</div>
                                    </div>
                                    <div class="message-content">
                                        <div class="message-text">è¯¾æ€ä¹ˆä¹°</div>
                                        <div class="message-controls">
                                            <label>
                                                <input type="checkbox" class="include-checkbox" checked>
                                                åŒ…å«åœ¨æµ‹è¯•ä¸­
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="message ai" style="background:#e6f7ff;">
                                    <div class="message-header">
                                        <div class="message-avatar">AI</div>
                                        <div class="message-sender">AI</div>
                                        <div class="message-time">2025-06-20 10:00:05</div>
                                    </div>
                                    <div class="message-content">
                                        <div class="message-text">æ‚¨å¯ä»¥åœ¨è¯¾ç¨‹ä¸­å¿ƒé€‰æ‹©è´­ä¹°ï¼Œæ”¯æŒå¤šç§æ”¯ä»˜æ–¹å¼ã€‚</div>
                                        <div class="message-controls">
                                            <label>
                                                <input type="checkbox" class="include-checkbox" checked>
                                                åŒ…å«åœ¨æµ‹è¯•ä¸­
                                            </label>
                                            <button class="control-btn" onclick="retestMessage(this)">é‡æ–°æµ‹è¯•</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="chat-input-panel" style="display: flex; align-items: center; gap: 8px; padding: 12px 16px; border-top: 1px solid #d9d9d9; background: #fafafa;">
                                <span id="workflow-role-tip">ä½œä¸º</span>
                                <select id="workflowSenderRole" style="padding: 4px 8px; border-radius: 2px; border: 1px solid #d9d9d9;" onchange="updateRoleTip('workflow')">
                                    <option value="parent">å®¶é•¿</option>
                                    <option value="teacher">è€å¸ˆ</option>
                                </select>
                                <span id="workflow-role-tip">å‘é€ä¿¡æ¯ï¼š</span>
                                <select id="workflowEmojiPicker" style="padding: 4px 8px; border-radius: 2px; border: 1px solid #d9d9d9;">
                                    <option value="">æ·»åŠ è¡¨æƒ…</option>
                                </select>
                                <input id="workflowChatInput" type="text" placeholder="è¯·è¾“å…¥æ¶ˆæ¯..." style="flex:1; padding: 6px 8px; border-radius: 2px; border: 1px solid #d9d9d9;">
                                <button class="action-btn primary-btn" onclick="sendWorkflowChatMessage()">å‘é€</button>
                            </div>
                            <div class="action-panel">
                                <button class="action-btn" onclick="saveWorkflowSession()" style="margin-left: auto;">ä¿å­˜ä¼šè¯</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¼šè¯è®°å½•å¼¹çª— -->
    <div id="sessionLogModal" style="display:none; position:fixed; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.25); z-index:9999; align-items:center; justify-content:center;">
        <div style="background:#fff; border-radius:8px; min-width:340px; max-width:90vw; min-height:180px; box-shadow:0 4px 24px rgba(0,0,0,0.18); padding:24px 28px 18px 28px; position:relative;">
            <div style="font-size:18px; font-weight:bold; margin-bottom:12px;">ä¼šè¯è®°å½•</div>
            <div style="color:#888; font-size:14px; margin-bottom:16px;">å±•ç¤ºå·²ä¿å­˜çš„è®°å½•ï¼Œç‚¹å‡»åå¯ä»¥è·³è½¬åˆ°è¯¥æµ‹è¯•è®°å½•ã€‚</div>
            <ul id="sessionLogList" style="list-style:none; padding:0; margin:0;">
                <li style="padding:8px 0; border-bottom:1px solid #f0f0f0; cursor:pointer; color:#1890ff;" onclick="gotoSession('20240601-001')">2024-06-01 å®¶é•¿å’¨è¯¢è¯¾æ—¶åŒ…</li>
                <li style="padding:8px 0; border-bottom:1px solid #f0f0f0; cursor:pointer; color:#1890ff;" onclick="gotoSession('20240602-002')">2024-06-02 AIè‡ªåŠ¨ç­”ç–‘æµ‹è¯•</li>
                <li style="padding:8px 0; border-bottom:1px solid #f0f0f0; cursor:pointer; color:#1890ff;" onclick="gotoSession('20240603-003')">2024-06-03 å·¥ä½œæµæµç¨‹æµ‹è¯•</li>
            </ul>
            <button onclick="closeSessionLog()" style="position:absolute; right:12px; top:10px; background:none; border:none; font-size:20px; color:#888; cursor:pointer;">Ã—</button>
        </div>
    </div>

    <script>
        // åŠ è½½ä¼šè¯
        function loadSession(sessionId) {
            // å®é™…åº”ç”¨ä¸­è¿™é‡Œä¼šä»APIåŠ è½½æ•°æ®
            console.log('åŠ è½½ä¼šè¯:', sessionId);
            
            // æ›´æ–°è¡¨æ ¼é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.session-table tr').forEach(tr => {
                tr.classList.remove('active');
            });
            event.target.closest('tr').classList.add('active');
            
            // è¿™é‡Œåªæ˜¯ç¤ºä¾‹ï¼Œå®é™…åº”ç”¨ä¸­ä¼šæ›¿æ¢æ•´ä¸ªå¯¹è¯å†…å®¹
        }
        
        // é‡æ–°æµ‹è¯•å•æ¡æ¶ˆæ¯
        function retestMessage(button) {
            const message = button.closest('.message');
            // ä»…å…è®¸AIæ¶ˆæ¯é‡è¯•
            if (!message.classList.contains('ai')) return;
            const contentDiv = message.querySelector('.message-content');
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            const loading = document.createElement('div');
            loading.textContent = 'æµ‹è¯•ä¸­...';
            loading.style.color = '#999';
            contentDiv.appendChild(loading);
            // æ¨¡æ‹ŸAPIè°ƒç”¨å»¶è¿Ÿ
            setTimeout(() => {
                contentDiv.removeChild(loading);
                // åˆ›å»ºæµ‹è¯•ç»“æœåŒºåŸŸï¼ˆå¸¦ç‰¹æ®Šæ ·å¼ï¼‰
                const testResult = document.createElement('div');
                testResult.className = 'test-result-box';
                testResult.innerHTML = `
                    <div class="test-result-title">AIé‡è¯•ç»“æœ <span style='font-size:12px;color:#888;'>(${new Date().toLocaleString()})</span></div>
                    <div class="test-result-diff">è¿™æ˜¯é‡æ–°æµ‹è¯•åçš„AIå›å¤ï¼Œä¼šä¸<span class="diff-removed">åŸç»“æœ</span>è¿›è¡Œ<span class="diff-added">å·®å¼‚å¯¹æ¯”</span>ã€‚</div>
                `;
                contentDiv.appendChild(testResult);
                testResult.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 800);
        }
        
        // å‘é€èŠå¤©æ¶ˆæ¯
        function sendChatMessage() {
            const role = document.getElementById('senderRole').value;
            const emoji = document.getElementById('emojiPicker').options[document.getElementById('emojiPicker').selectedIndex].text;
            const input = document.getElementById('chatInput');
            let text = input.value;
            if (emoji && emoji !== 'æ·»åŠ è¡¨æƒ…') text += ' ' + emoji;
            if (!text.trim()) return;
            const conversation = document.getElementById('conversation-container');
            // æ„é€ æ¶ˆæ¯HTML
            const now = new Date();
            const timeStr = now.getFullYear() + '-' + String(now.getMonth()+1).padStart(2,'0') + '-' + String(now.getDate()).padStart(2,'0') + ' ' + now.toTimeString().slice(0,8);
            let sender = role === 'parent' ? 'å®¶é•¿' : (role === 'teacher' ? 'è€å¸ˆ' : 'AI');
            let avatar = role === 'parent' ? 'å®¶' : (role === 'teacher' ? 'å¸ˆ' : 'AI');
            let msgClass = role;
            const msgDiv = document.createElement('div');
            msgDiv.className = `message ${msgClass}`;
            msgDiv.innerHTML = `
                <div class="message-header">
                    <div class="message-avatar">${avatar}</div>
                    <div class="message-sender">${sender}</div>
                    <div class="message-time">${timeStr}</div>
                </div>
                <div class="message-content">
                    <div class="message-text">${text}</div>
                    <div class="message-controls">
                        <label>
                            <input type="checkbox" class="include-checkbox" checked>
                            åŒ…å«åœ¨æµ‹è¯•ä¸­
                        </label>
                        ${role === 'ai' ? '<button class="control-btn" onclick="retestMessage(this)">é‡æ–°æµ‹è¯•</button>' : ''}
                    </div>
                </div>
            `;
            conversation.appendChild(msgDiv);
            input.value = '';
            conversation.scrollTop = conversation.scrollHeight;
        }
        
        // ä¿å­˜ä¼šè¯
        function saveTestCase() {
            alert('æµ‹è¯•ç”¨ä¾‹å·²ä¿å­˜ï¼ˆå®é™…åº”ç”¨ä¸­ä¼šè°ƒç”¨APIï¼‰');
        }
        
        // åˆå§‹åŒ– - åŠ è½½ç¬¬ä¸€æ¡ä¼šè¯
        document.addEventListener('DOMContentLoaded', function() {
            // å¯ä»¥æ·»åŠ åˆå§‹åŒ–é€»è¾‘
        });

        function updateRoleTip(type) {
            let role, tipId;
            if (type === 'badcase') {
                role = document.getElementById('senderRole').value;
                tipId = 'badcase-role-tip';
            } else {
                role = document.getElementById('workflowSenderRole').value;
                tipId = 'workflow-role-tip';
            }
            let roleName = role === 'parent' ? 'å®¶é•¿' : (role === 'teacher' ? 'è€å¸ˆ' : 'AI');
            document.getElementById(tipId).textContent = `ä½œä¸ºã€${roleName}ã€‘å‘é€ä¿¡æ¯ï¼š`;
        }

        function openSessionLog() {
            document.getElementById('sessionLogModal').style.display = 'flex';
        }

        function closeSessionLog() {
            document.getElementById('sessionLogModal').style.display = 'none';
        }

        function gotoSession(sessionId) {
            closeSessionLog();
            alert('è·³è½¬åˆ°æµ‹è¯•è®°å½•: ' + sessionId + 'ï¼ˆå®é™…åº”ç”¨ä¸­ä¼šå®šä½åˆ°è¯¥ä¼šè¯ï¼‰');
        }

        function switchMode(mode, btn) {
            // åˆ‡æ¢æŒ‰é’®é«˜äº®
            document.querySelectorAll('.mode-btn').forEach(b => {
                b.classList.remove('active');
                b.classList.add('inactive');
            });
            if (btn) {
                btn.classList.add('active');
                btn.classList.remove('inactive');
            } else {
                document.querySelector('.mode-btn[data-mode="' + mode + '"]').classList.add('active');
                document.querySelector('.mode-btn[data-mode="' + mode + '"]').classList.remove('inactive');
            }
            // åˆ‡æ¢å†…å®¹åŒºæ˜¾ç¤º
            if (mode === 'workflow') {
                document.getElementById('badcase-panel').style.display = 'none';
                document.getElementById('workflow-panel').style.display = 'flex';
            } else {
                document.getElementById('badcase-panel').style.display = 'flex';
                document.getElementById('workflow-panel').style.display = 'none';
            }
        }

        // å·¥ä½œæµæ¨¡å¼ä¸‹å‘é€æ¶ˆæ¯
        function sendWorkflowChatMessage() {
            const role = document.getElementById('workflowSenderRole').value;
            const emoji = document.getElementById('workflowEmojiPicker').options[document.getElementById('workflowEmojiPicker').selectedIndex].text;
            const input = document.getElementById('workflowChatInput');
            let text = input.value;
            if (emoji && emoji !== 'æ·»åŠ è¡¨æƒ…') text += ' ' + emoji;
            if (!text.trim()) return;
            const conversation = document.getElementById('workflow-conversation-container');
            // æ„é€ æ¶ˆæ¯HTML
            const now = new Date();
            const timeStr = now.getFullYear() + '-' + String(now.getMonth()+1).padStart(2,'0') + '-' + String(now.getDate()).padStart(2,'0') + ' ' + now.toTimeString().slice(0,8);
            let sender = role === 'parent' ? 'å®¶é•¿' : (role === 'teacher' ? 'è€å¸ˆ' : 'AI');
            let avatar = role === 'parent' ? 'å®¶' : (role === 'teacher' ? 'å¸ˆ' : 'AI');
            let msgClass = role;
            const msgDiv = document.createElement('div');
            msgDiv.className = `message ${msgClass}`;
            msgDiv.innerHTML = `
                <div class="message-header">
                    <div class="message-avatar">${avatar}</div>
                    <div class="message-sender">${sender}</div>
                    <div class="message-time">${timeStr}</div>
                </div>
                <div class="message-content">
                    <div class="message-text">${text}</div>
                    <div class="message-controls">
                        <label>
                            <input type="checkbox" class="include-checkbox" checked>
                            åŒ…å«åœ¨æµ‹è¯•ä¸­
                        </label>
                    </div>
                </div>
            `;
            conversation.appendChild(msgDiv);
            input.value = '';
            conversation.scrollTop = conversation.scrollHeight;
        }

        // ä¿å­˜å·¥ä½œæµä¼šè¯
        function saveWorkflowSession() {
            alert('å·¥ä½œæµä¼šè¯å·²ä¿å­˜ï¼ˆå®é™…åº”ç”¨ä¸­ä¼šè°ƒç”¨APIï¼‰');
        }
    </script>
</body>
</html>
           